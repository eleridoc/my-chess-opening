<div class="app-page">
	<!-- Filters row (kept compact via app-density wrapper) -->
	<div class="app-filters app-density--5">
		<div class="app-filters__main">
			<mat-form-field appearance="fill" subscriptSizing="dynamic" class="games-search">
				<mat-label>Search</mat-label>
				<input
					matInput
					[ngModel]="search()"
					(ngModelChange)="onSearch($event)"
					placeholder="player, opening, ECO, external id…"
				/>
			</mat-form-field>

			<button matButton="outlined" type="button" (click)="reloadNow()">
				<mat-icon>refresh</mat-icon>
				Reload
			</button>
		</div>
	</div>

	<div class="app-table-card app-table-card--compact">
		<div class="app-table-card__scroll">
			<table mat-table [dataSource]="items()" class="games-table" [trackBy]="trackById">
				<!-- playedAt -->
				<ng-container matColumnDef="playedAt">
					<th mat-header-cell *matHeaderCellDef>Played</th>
					<td mat-cell *matCellDef="let g">
						{{ g.playedAtIso | date: 'yyyy-MM-dd HH:mm' }}
					</td>
				</ng-container>

				<!-- site -->
				<ng-container matColumnDef="site">
					<th mat-header-cell *matHeaderCellDef>Site</th>
					<td mat-cell *matCellDef="let g">
						<!--
							We keep a real <a> element for semantics, but we prevent default navigation
							and open it via Electron (system browser) in openExternal().
						-->
						<a
							class="games-site-link"
							[class.games-site-link--disabled]="!g.externalUrl"
							[attr.href]="g.externalUrl || null"
							[attr.aria-disabled]="!g.externalUrl"
							[attr.tabindex]="g.externalUrl ? 0 : -1"
							(click)="openExternal(g.externalUrl, $event)"
						>
							{{ g.site }}
						</a>
					</td>
				</ng-container>

				<!-- white -->
				<ng-container matColumnDef="white">
					<th mat-header-cell *matHeaderCellDef>White</th>
					<td mat-cell *matCellDef="let g">
						<span class="games-player" [ngClass]="playerClasses(g, 'white')">
							<span class="games-player__name">{{ g.whiteUsername }}</span>
							<span class="games-player__elo">({{ g.whiteElo ?? '—' }})</span>
						</span>
					</td>
				</ng-container>

				<!-- black -->
				<ng-container matColumnDef="black">
					<th mat-header-cell *matHeaderCellDef>Black</th>
					<td mat-cell *matCellDef="let g">
						<span class="games-player" [ngClass]="playerClasses(g, 'black')">
							<span class="games-player__name">{{ g.blackUsername }}</span>
							<span class="games-player__elo">({{ g.blackElo ?? '—' }})</span>
						</span>
					</td>
				</ng-container>

				<!-- result -->
				<ng-container matColumnDef="result">
					<th mat-header-cell *matHeaderCellDef>Result</th>
					<td mat-cell *matCellDef="let g">{{ myResultLabel(g) }}</td>
				</ng-container>

				<!-- moves -->
				<ng-container matColumnDef="moves">
					<th mat-header-cell *matHeaderCellDef>Moves</th>
					<td mat-cell *matCellDef="let g" class="games-moves">
						{{ g.movesCount }}
					</td>
				</ng-container>

				<!-- opening -->
				<ng-container matColumnDef="opening">
					<th mat-header-cell *matHeaderCellDef>Opening</th>
					<td mat-cell *matCellDef="let g">
						<span class="games-opening">
							<span *ngIf="g.eco" class="games-eco">{{ g.eco }}</span>
							<span class="games-opening-name">{{ g.opening ?? '(unknown)' }}</span>
						</span>
					</td>
				</ng-container>

				<!-- speed -->
				<ng-container matColumnDef="speed">
					<th mat-header-cell *matHeaderCellDef>Speed</th>
					<td mat-cell *matCellDef="let g">{{ g.speed }}</td>
				</ng-container>

				<!-- time -->
				<ng-container matColumnDef="time">
					<th mat-header-cell *matHeaderCellDef>Time</th>
					<td mat-cell *matCellDef="let g" class="games-time-compact">
						{{ timeLabel(g.timeControl) }}
					</td>
				</ng-container>

				<!-- rated -->
				<ng-container matColumnDef="rated">
					<th mat-header-cell *matHeaderCellDef>Type</th>
					<td mat-cell *matCellDef="let g">{{ g.rated ? 'Rated' : 'Casual' }}</td>
				</ng-container>

				<!-- actions -->
				<ng-container matColumnDef="actions">
					<th mat-header-cell *matHeaderCellDef></th>
					<td mat-cell *matCellDef="let g" class="app-table-card__actions">
						<!-- Accessible "button-like" span (keeps your styling) -->
						<span
							class="app-table-card__icon-button"
							role="button"
							tabindex="0"
							aria-label="Open in Explorer"
							(click)="openInExplorer(g.id)"
							(keydown.enter)="openInExplorer(g.id)"
							(keydown.space)="openInExplorer(g.id)"
						>
							<mat-icon>biotech</mat-icon>
						</span>
					</td>
				</ng-container>

				<!-- Sticky header is applied to the header row (one single place) -->
				<tr
					mat-header-row
					*matHeaderRowDef="displayedColumns"
					class="app-table-card__sticky-header"
				></tr>
				<tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
			</table>

			<div *ngIf="!loading() && items().length === 0" class="games-empty">No games.</div>
		</div>

		<!-- Paginator is outside scroll area: always visible -->
		<mat-paginator
			class="app-table-card__paginator"
			[length]="total()"
			[pageIndex]="page() - 1"
			[pageSize]="pageSize()"
			[pageSizeOptions]="[25, 50, 100, 200]"
			(page)="onPage($event)"
		></mat-paginator>
	</div>
</div>
