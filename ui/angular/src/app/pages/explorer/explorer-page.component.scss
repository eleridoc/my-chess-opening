/*
  Explorer page layout styles

  Goals:
  - Full-height 3-column layout (Left | Center | Right)
  - Columns must be allowed to shrink (min-height: 0) to avoid pushing the page
  - Prepare the ground for localized scroll areas (next steps)
*/

:host {
	display: block;
	height: 100%;
	min-height: 0;
}

/* ---------------------------------------------------------------------------
   Grid layout (full height)
   --------------------------------------------------------------------------- */

.explorer-layout {
	display: grid;

	/* Desktop default: 3 equal columns */
	grid-template-columns: repeat(3, minmax(0, 1fr));

	/*
	  Force the single grid row to take the available height.
	  This is critical to prevent the layout from growing with content.
	*/
	grid-template-rows: minmax(0, 1fr);

	gap: 16px;

	/* Make columns stretch to full height */
	align-items: stretch;

	/* Fill the remaining height inside .app-page (flex column) */
	flex: 1 1 auto;
	min-height: 0;
	height: 100%;
}

.explorer-col {
	display: flex;
	flex-direction: column;

	//gap: 12px;

	/* Critical: allow inner children to shrink */
	min-height: 0;

	/* Prevent long content from forcing horizontal overflow */
	min-width: 0;
}

/* ---------------------------------------------------------------------------
   Left column: game info (auto) + tabs (fill remaining height)
   --------------------------------------------------------------------------- */

.explorer-col--left {
	overflow: hidden; /* prevent the column from creating its own scrollbar */
}

.explorer-left-tabs {
	flex: 1 1 auto;
	min-height: 0; /* critical: allows tab body to shrink and scroll */
	overflow: hidden; /* scroll must happen inside tab body only */
	display: flex;
	flex-direction: column;
	//background-color: brown;
}

/* ---------------------------------------------------------------------------
   Center column: 
   --------------------------------------------------------------------------- */

.explorer-col--center {
	overflow: hidden; /* center column must never scroll */
	min-height: 0;
	gap: 12px;
}

/* Rows (player cards + controls) keep natural height */
.explorer-center-row {
	flex: 0 0 auto;
	min-height: 0;
}

/* The board area is a strict square (size is set in px from TS) */
.explorer-board-area {
	flex: 0 0 auto;
	align-self: center; /* center the square horizontally */
	min-width: 0;
	min-height: 0;
	overflow: hidden;
	display: flex;
}

/* Make the chess board component fill the square */
.explorer-board-area > app-chess-board {
	width: 100%;
	height: 100%;
	min-width: 0;
	min-height: 0;
}

/* Remaining blank space goes below controls, not between cards and board */
.explorer-center-spacer {
	flex: 1 1 auto;
	min-height: 0;
}

/* ---------------------------------------------------------------------------
   Controls row: takes remaining height and centers controls without affecting board sizing
   --------------------------------------------------------------------------- */

.explorer-center-row--controls {
	flex: 1 1 auto; /* takes remaining height */
	min-height: 0;

	/*
	  Use CSS Grid centering instead of flex pseudo-spacers.
	  This avoids side effects where pseudo elements can steal layout space and
	  reduce the board size even when there is enough room.
	*/
	display: grid;
	place-items: center;
}

.explorer-center-row--controls.app-container-fit {
	padding-top: 10px;
	padding-bottom: 10px;
}

/* ---------------------------------------------------------------------------
   Right column: 2 equal blocks (top/bottom), no wrapper scroll
   --------------------------------------------------------------------------- */

.explorer-col--right {
	overflow: hidden; /* prevents any column-level scrollbar */
	gap: 12px;
}

.explorer-right-block {
	flex: 1 1 0; /* 50/50 split (gap is excluded from the distribution) */
	min-height: 0; /* critical for nested flex/overflow to work */
	overflow: hidden; /* no scrollbar at wrapper level */
	display: flex;
	flex-direction: column;
}

.explorer-right-block--top > app-move-list {
	flex: 1 1 auto;
	min-height: 0;
}

.explorer-right-block--bottom > .app-card-flat {
	flex: 1 1 auto;
	min-height: 0;
	display: flex;
	flex-direction: column;
}

.explorer-right-bottom__placeholder {
	opacity: 0.75;
	font-size: 14px;
	padding: 15px;
	font-style: italic;
}

/* ---------------------------------------------------------------------------
   Material tabs: keep header fixed, give a real flex height to the active tab body
   and let Import stretch vertically.
   Scoped to Explorer to avoid global side-effects.
   --------------------------------------------------------------------------- */

:host ::ng-deep .explorer-left-tabs .mat-mdc-tab-group {
	height: 100%;
	min-height: 0;
	display: flex;
	flex-direction: column;
}

:host ::ng-deep .explorer-left-tabs .mat-mdc-tab-header {
	flex: 0 0 auto; /* never scroll */
}

/* Wrapper must be a flex container so the active body can truly fill remaining height */
:host ::ng-deep .explorer-left-tabs .mat-mdc-tab-body-wrapper {
	flex: 1 1 auto;
	min-height: 0;
	display: flex;
}

/* The active tab body becomes a flex column that fills the wrapper */
:host ::ng-deep .explorer-left-tabs .mat-mdc-tab-body.mat-mdc-tab-body-active {
	flex: 1 1 auto;
	min-height: 0;
	display: flex;
	flex-direction: column;
}

/* Tab content must also be a flex column so its first child can stretch */
:host ::ng-deep .explorer-left-tabs .mat-mdc-tab-body-content {
	flex: 1 1 auto;
	min-height: 0;
	display: flex;
	flex-direction: column;

	/* Avoid a second scrollbar here. */
	overflow: auto;
}

/* Import tab: avoid outer scroll, keep scrolling inside the textarea */
// :host ::ng-deep .explorer-left-tabs .mat-mdc-tab-body-content:has(app-explorer-import) {
// 	overflow: hidden;
// }

/* Make the Import component stretch inside the tab content */
:host ::ng-deep .explorer-left-tabs .mat-mdc-tab-body-content > app-explorer-import {
	flex: 1 1 auto;
	min-height: 0;
	display: flex;
}

/* ---------------------------------------------------------------------------
   Board centering / sizing
   --------------------------------------------------------------------------- */

.explorer-board-center {
	width: 100%;
	display: flex;
	justify-content: center; /* center horizontally */
}

/* Board is centered and capped but still responsive */
.explorer-board-center > app-chess-board {
	display: block;
	width: min(100%, 680px); /* tweak 680px to taste */
}

.explorer-board-center > app-player-info-card {
	display: block;
	width: min(100%, 680px);
}

/* ---------------------------------------------------------------------------
   Responsive breakpoints
   --------------------------------------------------------------------------- */

/* Slightly more controlled column widths for medium-large screens */
@media (max-width: 1200px) {
	.explorer-layout {
		grid-template-columns: 320px minmax(420px, 1fr) 380px;
	}
}

/* Mobile / narrow screens: stack everything */
@media (max-width: 980px) {
	// .explorer-layout {
	// 	grid-template-columns: 1fr;

	// 	/*
	// 	  On small screens we allow natural height (page scroll is acceptable).
	// 	  Localized scroll zones are mainly targeted for desktop layout.
	// 	*/
	// 	grid-template-rows: auto;
	// 	height: auto;
	// }

	.explorer-layout {
		/*
		  On mobile we want the page to size naturally to content.
		  This prevents the center column from being forced into a "desktop-like" sizing behavior.
		*/
		flex: 0 0 auto;
		min-height: auto;
	}

	.explorer-board-center {
		/*
		  On narrow screens we prefer a full-width board container.
		  Desktop keeps "centered + capped" behavior.
		*/
		justify-content: stretch;
	}

	.explorer-board-center > app-chess-board {
		/*
		  Allow the board to fully use the available width on mobile.
		  Desktop remains capped via the default rule.
		*/
		width: 100%;
		max-width: none;
	}
}
