<div class="app-page">
	<div class="explorer-layout">
		<!-- Left column: game info + tabs -->
		<section class="explorer-col explorer-col--left app-container">
			<app-explorer-game-info-panel [facade]="facade"></app-explorer-game-info-panel>

			<div class="explorer-left-tabs">
				<mat-tab-group mat-stretch-tabs="false" mat-align-tabs="end">
					<mat-tab>
						<ng-template mat-tab-label>
							<span
								class="app-tab-label-icon"
								matTooltip="Import"
								[matTooltipDisabled]="false"
								aria-label="Import"
							>
								<mat-icon class="app-tab-icon" aria-hidden="true">content_paste_go</mat-icon>
							</span>

							<span class="app-sr-only">Import</span>
						</ng-template>

						<app-explorer-import
							[disabled]="facade.promotionPending() !== null"
							[fenError]="facade.importFenError()"
							[pgnError]="facade.importPgnError()"
							(applyFen)="onApplyFen($event)"
							(applyPgn)="onApplyPgn($event)"
							(clearFenError)="facade.clearImportFenError()"
							(clearPgnError)="facade.clearImportPgnError()"
						/>
					</mat-tab>

					<!-- <mat-tab disabled>
						<ng-template mat-tab-label>
							<span
								class="app-tab-label-icon"
								matTooltip="Analysis"
								[matTooltipDisabled]="false"
								aria-label="Analysis"
							>
								<mat-icon class="app-tab-icon" aria-hidden="true">timeline</mat-icon>
							</span>

							<span class="app-sr-only">Analysis</span>
						</ng-template>

						Content
					</mat-tab>

					<mat-tab disabled>
						<ng-template mat-tab-label>
							<span
								class="app-tab-label-icon"
								matTooltip="Export"
								[matTooltipDisabled]="false"
								aria-label="Export"
							>
								<mat-icon class="app-tab-icon" aria-hidden="true">share</mat-icon>
							</span>

							<span class="app-sr-only">Export</span>
						</ng-template>
						<div *ngFor="let _ of [].constructor(100)">TEST div</div>
						Content
					</mat-tab> -->

					@if (isDevBuild) {
						<mat-tab>
							<ng-template mat-tab-label>
								<span
									class="app-tab-label-icon"
									matTooltip="Debug"
									[matTooltipDisabled]="false"
									aria-label="Debug"
								>
									<mat-icon class="app-tab-icon" aria-hidden="true">bug_report</mat-icon>
								</span>

								<span class="app-sr-only">Debug</span>
							</ng-template>

							<app-explorer-debug-tab />
						</mat-tab>

						<!-- <mat-tab>
							<ng-template mat-tab-label>
								<mat-icon class="app-tab-icon">bug_report</mat-icon>
							</ng-template>

							
						</mat-tab> -->
					}
				</mat-tab-group>
			</div>
		</section>

		<!-- Center column: players + board + controls -->
		<section class="explorer-col explorer-col--center" #centerCol>
			<div #topPlayerWrap class="explorer-center-row">
				<app-player-info-card
					position="top"
					[header]="facade.gameInfoHeaderVm()"
				></app-player-info-card>
			</div>

			<div
				#boardArea
				class="explorer-board-area"
				[style.width.px]="boardSizePx()"
				[style.height.px]="boardSizePx()"
			>
				<app-chess-board
					[fen]="facade.fen()"
					[orientation]="facade.boardOrientation()"
					[inputEnabled]="inputEnabled()"
					[validateMoveAttempt]="validateMoveAttempt"
					[lastMoveSquares]="facade.lastMoveSquares()"
					[getLegalDestinationsFrom]="getLegalDestinationsFrom"
					[getLegalCaptureDestinationsFrom]="getLegalCaptureDestinationsFrom"
				/>
			</div>

			<div #bottomPlayerWrap class="explorer-center-row">
				<app-player-info-card
					position="bottom"
					[header]="facade.gameInfoHeaderVm()"
				></app-player-info-card>
			</div>

			<div
				#controlsWrap
				class="explorer-center-row explorer-center-row--controls app-container-fit"
			>
				<app-board-controls
					#boardControls
					[canStart]="facade.canStart()"
					[canPrev]="facade.canPrev()"
					[canNext]="facade.canNext()"
					[canEnd]="facade.canEnd()"
					(rotate)="onRotateBoard()"
					(reset)="onReset()"
					(start)="onStart()"
					(prev)="onPrev()"
					(next)="onNext()"
					(end)="onEnd()"
				/>
			</div>

			<!-- Optional: keep a spacer at the bottom to absorb remaining height -->
			<!-- <div class="explorer-center-spacer"></div> -->
		</section>

		<!-- Right column: split into 2 equal blocks (top/bottom) -->
		<section class="explorer-col explorer-col--right">
			<div class="explorer-right-block explorer-right-block--top">
				<app-move-list
					[rows]="facade.moveListRows()"
					[variationsByNodeId]="facade.variationsByNodeId()"
					[currentNodeId]="facade.currentNodeId()"
					(nodeSelected)="onNodeSelected($event)"
				></app-move-list>
			</div>

			<div class="explorer-right-block explorer-right-block--bottom">
				<div class="app-card-flat">
					<div class="app-card-flat-top">Movements played</div>
					<div class="app-card-flat-content-fit">
						<div class="explorer-right-bottom__placeholder">Coming soonâ€¦</div>
					</div>
				</div>
			</div>
		</section>
	</div>
</div>
